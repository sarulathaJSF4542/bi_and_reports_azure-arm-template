@{
    Layout = null;
    var token = ViewBag.Token;
    var cdnLink = GlobalAppSettings.CdnDomain;
    var dashboardServerResourceUrl = ViewBag.appsettings.SystemSettings.CDNLink.TrimEnd('/');
    var headerLogo = string.Empty;
    if (!string.IsNullOrWhiteSpace(ViewBag.appsettings.SystemSettings.LoginLogo))
    {
        headerLogo = ViewBag.appsettings.SystemSettings.LoginLogo;
    }
    else
    {
        headerLogo = dashboardServerResourceUrl  + "/cdn/images/application/boldbi/deployment_header_logo.svg";
    }
    var pathbase = Context.Request.PathBase;
    var tenantId = ViewBag.TenantInfoId;
}
<!DOCTYPE html>
<html class="dashboard-server">
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Registration - @GlobalAppSettings.BrandingDisplayName Enterprise Dashboards</title>
    <environment include="Development,CloudDevelopment">
        <script asp-append-version="true" src="@dashboardServerResourceUrl/cdn/scripts/tenant-registration.js"></script>
        <script asp-append-version="true" src="@dashboardServerResourceUrl/cdn/scripts/signalr/signalr.js"></script>
        <link rel="stylesheet" asp-append-version="true" href="@dashboardServerResourceUrl/cdn/css/layout.css" />
        <link rel="stylesheet" asp-append-version="true" href="@dashboardServerResourceUrl/cdn/css/tenant-registration-page.css" />
        <script asp-append-version="true" src="~/js/localizationcontent.js?c=@System.Globalization.CultureInfo.CurrentCulture"></script>
    </environment>
    <environment exclude="Development,CloudDevelopment">
        <script asp-append-version="true" src="@dashboardServerResourceUrl/cdn/scripts/tenant-registration.min.js"></script>
        <script asp-append-version="true" src="@dashboardServerResourceUrl/cdn/scripts/signalr/signalr.min.js"></script>
        <link rel="stylesheet" asp-append-version="true" href="@dashboardServerResourceUrl/cdn/css/layout.min.css" />
        <link rel="stylesheet" asp-append-version="true" href="@dashboardServerResourceUrl/cdn/css/tenant-registration-page.min.css" />
        <script asp-append-version="true" src="~/js/localizationcontent.js?c=@System.Globalization.CultureInfo.CurrentCulture"></script>
    </environment>
    <script>
        var statusTracker;
        var setSystemSettingsUrl = "@Url.Action("SetSystemSettings", "ServerConfiguration")";
        var progressStatusUrl = "@Url.Action("ProgressStatus", "ServerConfiguration")";
        var idpUrl = "@ServerAppConfig.InternalAppIdpUrl";
        $(function() {
            setTimeout(function () {
                $('#circle').circleProgress('value', 0.18);
                IsSentRequest();
            }, 2000);

            $('#circle').circleProgress('value', 0.05);
            setInterval(function () {
                $.ajax({
                    type: "POST",
                    url: progressStatusUrl,
                data: {
                    tenantId: "@tenantId"
                },
                success: function (result) {
                    var circleValue = $('#circle').circleProgress('value');
                    if ((result.Percentage / 100) > circleValue) {
                        $('#circle').circleProgress('value', result.Percentage / 100);
                    }

                    if (result.Message != undefined && result.Message != null) {
                        $("#deployment-status").text(result.Message + "...");
                    }    

                    if (result.AdditionalData != undefined && result.AdditionalData != null) {
                        $(".user-name span").text(result.AdditionalData.DisplayName);
                        $(".profile-pic-tag").attr({
                            "data-id": result.AdditionalData.UserId,
                            "data-display-name": result.AdditionalData.DisplayName
                        });

                        generateProfileAvatar();
                        $(".dashboard-parent-container > a, #close-welcome-page").attr("href", result.AdditionalData.RedirectUrl);
                    }
                }
            });                
            }, 3000);
        });

        $(window).load(function () {
            $('.lazyload').each(function () {
                if ($(this).attr("data-id") == "footerlogo") {
                    $(this).parent().find("p#poweredbysyncfusion").append($("<img>").attr({
                        "src": $(this).attr("data-src"),
                        "alt": $(this).attr("data-alt"),
                        "id": $(this).attr("data-id"),
                        "onerror": $(this).attr("data-default")
                    }));

                }

                $(this).remove();
            });
        });

        function IsSentRequest() {
            $.ajax({
                type: "POST",
                url: setSystemSettingsUrl,
                data: {
                    token: "@token"
                },
                success: function (result) {
                    if (result.isDefaultTenant) {
                        $(".deploy-tenant-parent, .deployment-footer").addClass("hide");
                        $("body").addClass("welcome-page-footer-alignment");
                        $(".deployment-header, .welcome-tenant-parent, .base-footer-wrapper").removeClass("hide");                        
                    }
                    else {
                        window.location = result.redirectUrl
                    }                    
                }
            });
        }
    </script>
</head>
<body>
    <div class="deploy-tenant-parent">
        <div class="deploy-tenant-child">
            <div class="deployment-page-image">
                <img class="boldbi-logo" src="@headerLogo"/>
            </div>
            <div class="deploy-tenant-bg">
                <div class="text-h1 deployment-content">[[[Registering your site...]]]</div>
                <div class="text-body deployment-content-small">[[[Sit back and relax. We’ll let you know when your setup is ready to go!]]]</div>
                <div class="deployment-container">
                    <div class="circle-progress">
                        <div class="wrapper">
                            <img src="@dashboardServerResourceUrl/cdn/images/application/boldbi/deploymentimage.gif" />
                            <div id="circle"></div>
                        </div>
                    </div>
                </div>
                <div id="deployment-status" class="text-body deployment-content-small">[[[Fetching site information...]]]</div>
            </div>
        </div>
    </div>
    <footer class="deployment-footer">
        <span class="footer-content">[[[Powered by]]]</span><img class="footer-logo" src="@dashboardServerResourceUrl/cdn/images/application/boldbi/footer_logo.svg" />
    </footer>

    <header class="deployment-header hide">
        <div class="deployment-header-container">
            <img class="boldbi-logo" src="@headerLogo"/>
            <a id="close-welcome-page" class="su-close"></a>
        </div>
    </header>
    <div class="welcome-tenant-parent hide">
        <div class="welcome-tenant-child">
            <div class="welcome-tenant-bg">
                <div id="user-profile-picture">
                    <div class="profile-pic-tag" data-type="user" data-image-size="100" data-toggle="tooltip" data-placement="top"></div>
                </div>
                <div class="user-name">[[[Hello,]]] <span></span></div>
                <div class="welcome-content">[[[Welcome to Bold BI Enterprise Dashboards]]]</div>
                <div class="tenant-parent-container">
                    <a class="admin-link-container" rel="alternate" hreflang="en" href="@ServerAppConfig.InternalAppIdpUrl/@ServerAppConfig.TenantManagementHostName/sites">
                        <table class="admin-options">
                            <tr>
                                <td class="action-logo" rowspan="2">
                                    <img src="@dashboardServerResourceUrl/cdn/images/application/boldbi/manage_tenant.svg" />
                                </td>
                                <td class="action-title">
                                    <div>[[[Manage your Sites]]]</div>
                                </td>
                            </tr>
                            <tr>
                                <td class="action-description">
                                    [[[Manage permissions for the sites you created.]]]
                                    <a class="su-arrow-right"></a>
                                </td>
                            </tr>
                        </table>
                    </a>
                </div>
                <div class="dashboard-parent-container">
                    <a class="admin-link-container">
                        <table class="admin-options">
                            <tr>
                                <td class="action-logo" rowspan="2">
                                    <img src="@dashboardServerResourceUrl/cdn/images/application/boldbi/goto_dashboard.svg" />
                                </td>
                                <td class="action-title">
                                    <div>[[[Go to Dashboards]]]</div>
                                </td>
                            </tr>
                            <tr>
                                <td class="action-description">
                                    [[[Get started creating dashboards.]]]
                                    <a class="su-arrow-right"></a>
                                </td>
                            </tr>
                        </table>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="base-footer-wrapper hide">
        @await Html.PartialAsync("~/Views/Shared/_Footer.cshtml")
    </div>
</body>
</html>
