/*!
*  filename: schedulerrecipients.min.js
*  version : unknown version
*  Copyright Syncfusion Inc. 2001 - 2013. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
function getAllStaticData(){window.userList==undefined&&$.ajax({type:"POST",url:getActiveandInactiveUserUrl,data:{},async:!1,success:function(n){window.userList=n.data.users;window.groupList=n.data.groups}});$("#user-search").append(window.userList);$("#group-search").append(window.groupList);canExport.Image?$("#image-export").prop("checked",!0):canExport.Pdf?$("#pdf-export").prop("checked",!0):canExport.Excel&&$("#excel-export").prop("checked",!0);$(".selectpicker").selectpicker("refresh");$("#schedule-submit").attr("data-report-id",createdItemId);$(".share-popup .bs-deselect-all").after("<div class='bs-select-all-custom'><span>"+window.Server.App.LocalizationContent.Select+"<\/span><span class='bs-select-custom-tick glyphicon glyphicon-ok' ><\/span><\/div>");$("#user-search-container .bootstrap-select .bs-searchbox .input-block-level").attr("placeholder",window.Server.App.LocalizationContent.SearchUsers);$("#group-search-container .bootstrap-select .bs-searchbox .input-block-level").attr("placeholder",window.Server.App.LocalizationContent.SearchGroups)}function validateExternalRecipient(){$(document).on("keypress","#external-email",function(n){n.which==13&&(n.preventDefault(),$("#external-submit").click())});$(document).on("click","#external-submit",function(){var n=$("#external-email").val().toLowerCase(),i=$(".selected-recipients").children(),r,t;if(IsEmail(n)){for(r=$("<div>").attr("id",n).attr("data-searchtype","externalRecipient").addClass("SelectedShareItems"),r.html("<div class='InstantSearch'><span class='details' title='"+n+"'>"+n+"<\/span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/><\/div><\/div>"),t=0;t<i.length;t++)if(i[t].getAttribute("data-searchtype")=="externalRecipient"&&n==i[t].id){$("#external-email").addClass("inactive-box");$("#external-submit").addClass("inactive-icon");$("#external-email-validation").html("<span class='validate-fail'>"+window.Server.App.LocalizationContent.IsMailExist+"<\/span>");return}$("#selected-users").append(r);$("#external-email").val("");selectedItemsCount()}else n!=""?($("#external-email").addClass("inactive-box"),$("#external-submit").addClass("inactive-icon"),$("#external-email-validation").html("<span class='validate-fail'>"+window.Server.App.LocalizationContent.IsValidEmail+"<\/span>")):($("#external-email").removeClass("inactive-box"),$("#external-submit").removeClass("inactive-icon"),$("#external-email-validation").html())});$(document).on("keyup","#external-email",function(n){n.keyCode!=13&&($("#external-email").removeClass("inactive-box"),$("#external-submit").removeClass("inactive-icon"),$("#external-email-validation").html(""))})}function selectedItemsCount(){$("#selected-users-info").html("<span class='pull-left'>"+$(".SelectedShareItems[data-searchtype='userSearch']").length+window.Server.App.LocalizationContent.Users+$(".SelectedShareItems[data-searchtype='groupSearch']").length+window.Server.App.LocalizationContent.Groups+$(".SelectedShareItems[data-searchtype='externalRecipient']").length+window.Server.App.LocalizationContent.ExternalRecipients+"<span>").css({"padding-top":"10px","padding-left":"15px","margin-top":"0"})}function validateSubscriber(){if(!$("#selected-users").children().length>0)return $("#selectedRecipientErrorContainer").css("display","block"),$("#selectedRecipientValidator").html(window.Server.App.LocalizationContent.RecipientValidator),!1;$("#selectedRecipientErrorContainer").css("display","none")}$(document).on("click","#user-search-container .bs-select-all-custom",function(n){$("#user-search-container").addClass("value-changed");$("#user-search").data("selectpicker").selectAll();$(this).removeClass("bs-select-all-custom").addClass("bs-deselect-all-custom");$($(this).children("span")[0]).text(window.Server.App.LocalizationContent.Clear);selectedItemsCount();n.stopPropagation()});$(document).on("click","#group-search-container .bs-select-all-custom",function(n){$("#group-search-container").addClass("value-changed");$("#group-search").data("selectpicker").selectAll();$(this).removeClass("bs-select-all-custom").addClass("bs-deselect-all-custom");$($(this).children("span")[0]).text(window.Server.App.LocalizationContent.Clear);selectedItemsCount();n.stopPropagation()});$(document).on("click","#user-search-container .bs-deselect-all-custom",function(n){$("#user-search-container").addClass("value-changed");$("#user-search").data("selectpicker").deselectAll();$(this).removeClass("bs-deselect-all-custom").addClass("bs-select-all-custom");$($(this).children("span")[0]).text(window.Server.App.LocalizationContent.Select);$(".SelectedShareItems[data-searchtype='userSearch']").remove();selectedItemsCount();n.stopPropagation()});$(document).on("click","#group-search-container .bs-deselect-all-custom",function(n){$("#group-search-container").addClass("value-changed");$("#group-search").data("selectpicker").deselectAll();$(this).removeClass("bs-deselect-all-custom").addClass("bs-select-all-custom");$($(this).children("span")[0]).text(window.Server.App.LocalizationContent.Select);$(".SelectedShareItems[data-searchtype='groupSearch']").remove();selectedItemsCount();n.stopPropagation()});$(document).on("click","#user-search-container .bootstrap-select li a",function(n){var r,u,i,t;$("#user-search-container").addClass("value-changed");r=$("#user-search-container .bootstrap-select li.selected").length;u=$("#user-search-container .bootstrap-select li").length;r==u&&($($("#user-search-container div.bs-select-all-custom").children("span")[0]).text(window.Server.App.LocalizationContent.Clear),$("#user-search-container div.bs-select-all-custom").removeClass("bs-select-all-custom").addClass("bs-deselect-all-custom"));$(this).parent().hasClass("selected")?(t=$("#user-search").find("option")[parseInt($(this).parent().attr("data-original-index"))],i=$("<div>").attr("id",$(t).val()).attr("data-searchtype","userSearch").addClass("SelectedShareItems"),i.html("<div class='InstantSearch'><span class='details' title='"+$(t).text()+"'>"+$(t).text()+"<\/span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/><\/div><\/div>"),$("#selected-users").append(i)):(t=$("#user-search").find("option")[parseInt($(this).parent().attr("data-original-index"))],$(".SelectedShareItems[id='"+$(t).val()+"']").remove(),$($("#user-search-container .bs-deselect-all-custom").children("span")[0]).text(window.Server.App.LocalizationContent.Select),$("#user-search-container .bs-deselect-all-custom").removeClass("bs-deselect-all-custom").addClass("bs-select-all-custom"));$(this).parent().addClass("active");selectedItemsCount();n.stopPropagation()});$(document).on("click","#group-search-container .bootstrap-select .dropdown-menu .selectpicker li a",function(n){var r,u,i,t;$("#group-search-container").addClass("value-changed");r=$("#group-search-container .bootstrap-select li.selected").length;u=$("#group-search-container .bootstrap-select li").length;r==u&&($($("#group-search-container div.bs-select-all-custom").children("span")[0]).text(window.Server.App.LocalizationContent.Clear),$("#group-search-container div.bs-select-all-custom").removeClass("bs-select-all-custom").addClass("bs-deselect-all-custom"));$(this).parent().hasClass("selected")?(t=$("#group-search").find("option")[parseInt($(this).parent().attr("data-original-index"))],i=$("<div>").attr("id",$(t).val()).attr("data-searchtype","groupSearch").addClass("SelectedShareItems"),i.html("<div class='InstantSearch'><span class='details' title='"+$(t).text()+"'>"+$(t).text()+"<\/span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/><\/div><\/div>"),$("#selected-users").append(i)):(t=$("#group-search").find("option")[parseInt($(this).parent().attr("data-original-index"))],$(".SelectedShareItems").filter("[data-searchtype='groupSearch']").filter("#"+$(t).val()).remove(),$($("#group-search-container .bs-deselect-all-custom").children("span")[0]).text(window.Server.App.LocalizationContent.Select),$("#group-search-container .bs-deselect-all-custom").removeClass("bs-deselect-all-custom").addClass("bs-select-all-custom"));$(this).parent().addClass("active");selectedItemsCount();n.stopPropagation()});$(document).on("click","#subscribers-panel .i-selected-cancel",function(){var n=$(this).parents(".SelectedShareItems").attr("id"),t=$(this).parents(".SelectedShareItems").attr("data-searchtype");t=="userSearch"?(currentElementIndex=$("#user-search").find("[value='"+n+"']").index(),$("#user-search-container .bootstrap-select li").filter("[data-original-index='"+currentElementIndex+"']").find("a").click()):t=="groupSearch"?(currentElementIndex=$("#group-search").find("[value='"+n+"']").index(),$("#group-search-container .bootstrap-select li").filter("[data-original-index='"+currentElementIndex+"']").find("a").click()):t=="externalRecipient"&&$(".SelectedShareItems[id='"+n+"']").remove();selectedItemsCount();$("#selected_childdashboard").attr("disabled",!1)});$(document).on("hide.bs.dropdown","#user-search-container",function(n){$("#user-search-container").hasClass("value-changed")&&($("#user-search-container").removeClass("value-changed"),n.stopPropagation())});$(document).on("hide.bs.dropdown","#group-search-container",function(n){$("#group-search-container").hasClass("value-changed")&&($("#group-search-container").removeClass("value-changed"),n.stopPropagation())});$(document).on("show.bs.dropdown","#user-search-container",function(){$("#user-search").next("div").find(".dropdown-menu").addClass("dropdown-width");for(var n=0;n<$("#user-search option").length;n++)$("#user-search option").eq(n).attr("data-show").toLowerCase()=="false"&&($("#user-search-container .dropdown-menu .inner li").eq(n).addClass("disabled user-disabled"),$("#user-search-container .dropdown-menu .inner li").eq(n).attr("data-toggle","tooltip").attr("data-placement","right").attr("data-original-title",window.Server.App.LocalizationContent.AutoGeneratedMail)),$('[data-toggle="tooltip"]').tooltip()});$(document).on("show.bs.dropdown","#group-search-container",function(){$("#group-search").next("div").find(".dropdown-menu").addClass("dropdown-width")});$(document).on("click","#schedule-submit",function(){var b,n,v,t;validateSubscriber();var h="",r="",f="";alertChange==2&&(h=window.Server.App.LocalizationContent.ConditionEvaluted,successMessage=window.Server.App.LocalizationContent.DataAlertConfigureSuccess,r=window.Server.App.LocalizationContent.DataAlertConfigureSuccessMessage,b=$(".time-width").val());n={};n.ScheduleName=$("#schedule-name").val();n.ItemId=$(this).attr("data-report-id");n.ExportType=$("input[name=exportFormats]:checked","#export-format-container").val().toString();actionType=="Create"?(successMessage=window.Server.App.LocalizationContent.DashboardScheduleSuccess,f=addScheduleUrl):(successMessage=window.Server.App.LocalizationContent.ScheduleUpdateSuccess,n.ScheduleId=$(this).attr("data-schedule-id"),n.FailureOccurrence=scheduleRecurrenceInfo.FailureOccurrence,f=updateScheduleUrl);var u="",c="",l="",a="";u=scheduleEmailEditRTE.value;u=getRelativePath(u);alertChange==2&&(c=filterContent.Filters,l=filterContent.DaJsonString,a=filterContent.DataSourceId);n.EmailContent=u;v=$("#alert-value").text();switch($("#recurrence-type").val().toString().toLowerCase()){case"daily":$("#daily-every-x-days").prop("checked")?(n.RecurrenceType="Daily",n.RecurrenceInterval=$("#every-x-days").val()):n.RecurrenceType="DailyWeekDay";break;case"weekly":n.RecurrenceType="Weekly";n.RecurrenceInterval=$("#every-x-weeks").val();n.Sunday=$("#sun").prop("checked");n.Monday=$("#mon").prop("checked");n.Tuesday=$("#tues").prop("checked");n.Wednesday=$("#wed").prop("checked");n.Thursday=$("#thu").prop("checked");n.Friday=$("#fri").prop("checked");n.Saturday=$("#sat").prop("checked");break;case"monthly":$("#monthly").prop("checked")?(n.RecurrenceType="Monthly",n.DaysOfMonth=$("#monthly-date").val(),n.RecurrenceInterval=$("#monthly-every-x-months").val()):(n.RecurrenceType="MonthlyDOW",n.WeekOfMonth=$("#monthly-dow-week").find("option:selected").text(),n.DayOfWeek=$("#monthly-dow-day").find("option:selected").text(),n.RecurrenceInterval=$("#monthly-dow-every-x-months").val());break;case"yearly":n.RecurrenceInterval=$("#every-x-years").val();$("#yearly").prop("checked")?(n.RecurrenceType="Yearly",n.DaysOfMonth=$("#yearly-day").val(),n.MonthOfYear=$("#yearly-month").find("option:selected").text()):(n.RecurrenceType="YearlyDOW",n.WeekOfMonth=$("#yearly-dow-week").find("option:selected").text(),n.DayOfWeek=$("#yearly-dow-day").find("option:selected").text(),n.MonthOfYear=$("#yearly-dow-month").find("option:selected").text());break;case"hourly":n.RecurrenceType="Hourly";n.Frequency=$(".time-width").val();n.RecurrenceInterval=$("#every-x-hours-value").val()}n.IsEnabled=$("#enable-schedule").prop("checked");n.FailureNotificationToOwner=$("#enable-notification-to-owner").prop("checked");n.FailureNotificationToRecipient=$("#enable-notification-to-recipient").prop("checked");n.StartDate=$("#start-date").val();switch($("input[name=end-type]:checked","#schedule-end-type").val().toString()){case"never":n.ScheduleEndType="NoEnd";break;case"endafter":n.ScheduleEndType="EndAfter";n.RecurrenceFactor=$("#occurence-count").val();break;case"endBy":n.ScheduleEndType="EndBy";n.EndDate=$("#end-date").val()}var i=$(".selected-recipients").children(),y=Array(),p=Array(),w=Array(),e=0,o=0,s=0;for(t=0;t<i.length;t++)i[t].getAttribute("data-searchtype")=="userSearch"&&e!=-1&&(y[e]=i[t].id,e++),i[t].getAttribute("data-searchtype")=="groupSearch"&&o!=-1&&(p[o]=i[t].id,o++),i[t].getAttribute("data-searchtype")=="externalRecipient"&&s!=-1&&(w[s]=i[t].id,s++);i.length?$.ajax({type:"POST",url:f,data:{scheduleList:JSON.stringify({ScheduleItem:n,UserList:y,GroupList:p,ExternalRecipientList:w,result:v,alert:alertChange,DataSourceId:a,FilterData:c,DaJsonString:l})},beforeSend:function(){parent.$("#popup-container_wrapper").ejWaitingPopup("show");parent.$("#editpopup-container_wrapper").ejWaitingPopup("show")},success:function(){var t,n,i;scheduleDetail=createScheduleMessage(!0);parent.$("#popup-container_wrapper").ejWaitingPopup("hide");parent.$("#editpopup-container_wrapper").ejWaitingPopup("hide");t=$(".schedule-popup-title").text();closePopupContainer();r=r==""?".":r;n=successMessage+h+scheduleDetail+r;i=n.length>140?"success-message-large":"success-message-small";parent.messageBox("su-calendar-1",t,n,"success",function(){if(parent.onCloseMessageBox(),typeof parent.refreshScheduleGrid=="function"&&parent.refreshScheduleGrid(),parent.$("#on-board-schedule-dashboard").length>0&&!parent.$("#on-board-share-dashboard").hasClass("journey-done")){parent.$("#on-board-schedule-dashboard").addClass("journey-done").removeAttr("id");var n=parseInt(parent.$(".progress-bar-success").attr("data-progress-percentage"))+parseInt(parent.$(".progress-bar-success").attr("data-increment"));parent.$(".progress-bar-success").css("width",n+"%").attr("data-progress-percentage",n);parent.$(".progress-bar-percentage").text(n+"%")}},undefined,undefined,undefined,undefined,i)}}):$("#selected-users-validation").css("visibility","visible")});$(document).ready(function(){var t,i,r,u,n,f,e;if($(".schedule-dialog #subscribers-panel").css("display","inline"),getAllStaticData(),actionType=="Create")$("select#user-search option").each(function(){var n,t;$(this).val().toLowerCase()==$("#userName").val().toLowerCase()&&(n=$(this).text(),$(this).attr("selected",!0),$("#user-search").selectpicker("refresh"),t=$("<div>").attr("id",$(this).val()).attr("data-searchtype","userSearch").addClass("SelectedShareItems"),t.html("<div class='InstantSearch'><span class='details' title='"+n+"'>"+n+"<\/span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/><\/div><\/div>"),$("#selected-users").append(t))});else{for(n=0;n<subscriberUser.length;n++)$("#user-search option[value='"+subscriberUser[n]+"']").attr("selected",!0),$("#user-search").selectpicker("refresh"),t=$("#user-search option[value='"+subscriberUser[n]+"']").text(),i=$("<div>").attr("id",subscriberUser[n]).attr("data-searchtype","userSearch").addClass("SelectedShareItems"),i.html("<div class='InstantSearch'><span class='details' title='"+t.trim()+"'>"+t.trim()+"<\/span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/><\/div><\/div>"),$("#selected-users").append(i);for(oldUserSelected=$("#user-search").val(),n=0;n<subscriberGroup.length;n++)$("#group-search option[value='"+subscriberGroup[n]+"']").attr("selected",!0),$("#group-search").selectpicker("refresh"),r=$("#group-search option[value='"+subscriberGroup[n]+"']").text(),u=$("<div>").attr("id",subscriberGroup[n]).attr("data-searchtype","groupSearch").addClass("SelectedShareItems"),u.html("<div class='InstantSearch'><span class='details' title='"+r.trim()+"'>"+r.trim()+"<\/span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/><\/div><\/div>"),$("#selected-users").append(u);for(oldGroupSelected=$("#group-search").val(),n=0;n<subscriberExternalRecipient.length;n++)f=subscriberExternalRecipient[n],e=$("<div>").attr("id",subscriberExternalRecipient[n]).attr("data-searchtype","externalRecipient").addClass("SelectedShareItems"),e.html("<div class='InstantSearch'><span class='details'title='"+f+"'>"+f+"<\/span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/><\/div><\/div>"),$("#selected-users").append(e);var o=$("#group-search-container .bootstrap-select li.selected").length,s=$("#group-search-container .bootstrap-select li").length,h=$("#user-search-container .bootstrap-select li.selected").length,c=$("#user-search-container .bootstrap-select li").length;o===s&&$("#group-search-container .bs-select-all-custom").removeClass("bs-select-all-custom").addClass("bs-deselect-all-custom");h===c&&$("#user-search-container .bs-select-all-custom").removeClass("bs-select-all-custom").addClass("bs-deselect-all-custom");$("#image-export").prop("checked",exportType.toLowerCase()=="image");$("#pdf-export").prop("checked",exportType.toLowerCase()=="pdf");$("#excel-export").prop("checked",exportType.toLowerCase()=="excel");$("#schedule-submit").attr("data-schedule-id",scheduleId)}scheduleRecurrenceInfo.FailureNotificationToOwner&&$("#enable-notification-to-owner").prop("checked",!0);scheduleRecurrenceInfo.FailureNotificationToRecipient&&$("#enable-notification-to-recipient").prop("checked",!0);selectedItemsCount();validateExternalRecipient();addTitleForUsersAndGroups();parent.$("#popup-container_wrapper").ejWaitingPopup("hide");parent.$("#editpopup-container_wrapper").ejWaitingPopup("hide")})